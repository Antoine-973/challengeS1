import{c as re,a as se}from"./vue-router-efb649a8.js";import{G as W,r as O,H as A,I as $,J as q,K as P,L as N,M as ce,N as ae,O as ie,P as ue,Q as le,R as fe,S as me,T as he,U as _e}from"./runtime-core.esm-bundler-4092eae4.js";var z=!1;/*!
  * pinia v2.0.29
  * (c) 2023 Eduardo San Martin Morote
  * @license MIT
  */let K;const j=e=>K=e,Q=Symbol();function C(e){return e&&typeof e=="object"&&Object.prototype.toString.call(e)==="[object Object]"&&typeof e.toJSON!="function"}var w;(function(e){e.direct="direct",e.patchObject="patch object",e.patchFunction="patch function"})(w||(w={}));function je(){const e=W(!0),n=e.run(()=>O({}));let t=[],o=[];const s=A({install(r){j(s),s._a=r,r.provide(Q,s),r.config.globalProperties.$pinia=s,o.forEach(c=>t.push(c)),o=[]},use(r){return!this._a&&!z?o.push(r):t.push(r),this},_p:t,_a:null,_e:e,_s:new Map,state:n});return s}const X=()=>{};function M(e,n,t,o=X){e.push(n);const s=()=>{const r=e.indexOf(n);r>-1&&(e.splice(r,1),o())};return!t&&fe()&&me(s),s}function y(e,...n){e.slice().forEach(t=>{t(...n)})}function D(e,n){e instanceof Map&&n instanceof Map&&n.forEach((t,o)=>e.set(o,t)),e instanceof Set&&n instanceof Set&&n.forEach(e.add,e);for(const t in n){if(!n.hasOwnProperty(t))continue;const o=n[t],s=e[t];C(s)&&C(o)&&e.hasOwnProperty(t)&&!P(o)&&!N(o)?e[t]=D(s,o):e[t]=o}return e}const pe=Symbol();function de(e){return!C(e)||!e.hasOwnProperty(pe)}const{assign:g}=Object;function ve(e){return!!(P(e)&&e.effect)}function ge(e,n,t,o){const{state:s,actions:r,getters:c}=n,u=t.state.value[e];let S;function l(){u||(t.state.value[e]=s?s():{});const f=$(t.state.value[e]);return g(f,r,Object.keys(c||{}).reduce((m,d)=>(m[d]=A(_e(()=>{j(t);const E=t._s.get(e);return c[d].call(E,E)})),m),{}))}return S=Y(e,l,n,t,o,!0),S.$reset=function(){const m=s?s():{};this.$patch(d=>{g(d,m)})},S}function Y(e,n,t={},o,s,r){let c;const u=g({actions:{}},t),S={deep:!0};let l,f,m=A([]),d=A([]),E;const b=o.state.value[e];!r&&!b&&(o.state.value[e]={}),O({});let G;function H(i){let a;l=f=!1,typeof i=="function"?(i(o.state.value[e]),a={type:w.patchFunction,storeId:e,events:E}):(D(o.state.value[e],i),a={type:w.patchObject,payload:i,storeId:e,events:E});const v=G=Symbol();he().then(()=>{G===v&&(l=!0)}),f=!0,y(m,a,o.state.value[e])}const Z=X;function x(){c.stop(),m=[],d=[],o._s.delete(e)}function ee(i,a){return function(){j(o);const v=Array.from(arguments),R=[],I=[];function oe(h){R.push(h)}function ne(h){I.push(h)}y(d,{args:v,name:i,store:p,after:oe,onError:ne});let L;try{L=a.apply(this&&this.$id===e?this:p,v)}catch(h){throw y(I,h),h}return L instanceof Promise?L.then(h=>(y(R,h),h)).catch(h=>(y(I,h),Promise.reject(h))):(y(R,L),L)}}const te={_p:o,$id:e,$onAction:M.bind(null,d),$patch:H,$reset:Z,$subscribe(i,a={}){const v=M(m,i,a.detached,()=>R()),R=c.run(()=>ue(()=>o.state.value[e],I=>{(a.flush==="sync"?f:l)&&i({storeId:e,type:w.direct,events:E},I)},g({},S,a)));return v},$dispose:x},p=le(te);o._s.set(e,p);const k=o._e.run(()=>(c=W(),c.run(()=>n())));for(const i in k){const a=k[i];if(P(a)&&!ve(a)||N(a))r||(b&&de(a)&&(P(a)?a.value=b[i]:D(a,b[i])),o.state.value[e][i]=a);else if(typeof a=="function"){const v=ee(i,a);k[i]=v,u.actions[i]=a}}return g(p,k),g(q(p),k),Object.defineProperty(p,"$state",{get:()=>o.state.value[e],set:i=>{H(a=>{g(a,i)})}}),o._p.forEach(i=>{g(p,c.run(()=>i({store:p,app:o._a,pinia:o,options:u})))}),b&&r&&t.hydrate&&t.hydrate(p.$state,b),l=!0,f=!0,p}function Se(e,n,t){let o,s;const r=typeof n=="function";typeof e=="string"?(o=e,s=r?t:n):(s=e,o=e.id);function c(u,S){const l=ae();return u=u||l&&ie(Q,null),u&&j(u),u=K,u._s.has(o)||(r?Y(o,n,s,u):ge(o,s,u)),u._s.get(o)}return c.$id=o,c}function Te(e){if(z)return $(e);{e=q(e);const n={};for(const t in e){const o=e[t];(P(o)||N(o))&&(n[t]=ce(e,t))}return n}}const Ee="modulepreload",be=function(e){return"/"+e},F={},_=function(n,t,o){if(!t||t.length===0)return n();const s=document.getElementsByTagName("link");return Promise.all(t.map(r=>{if(r=be(r),r in F)return;F[r]=!0;const c=r.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!o)for(let f=s.length-1;f>=0;f--){const m=s[f];if(m.href===r&&(!c||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${u}`))return;const l=document.createElement("link");if(l.rel=c?"stylesheet":Ee,c||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),c)return new Promise((f,m)=>{l.addEventListener("load",f),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>n())};function V(e){this.message=e}V.prototype=new Error,V.prototype.name="InvalidCharacterError";var J=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new V("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,o,s=0,r=0,c="";o=n.charAt(r++);~o&&(t=s%4?64*t+o:o,s++%4)?c+=String.fromCharCode(255&t>>(-2*s&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return c};function ye(e){var n=e.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(J(t).replace(/(.)/g,function(o,s){var r=s.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(n)}catch{return J(n)}}function U(e){this.message=e}function ke(e,n){if(typeof e!="string")throw new U("Invalid token specified");var t=(n=n||{}).header===!0?0:1;try{return JSON.parse(ye(e.split(".")[t]))}catch(o){throw new U("Invalid token specified: "+o.message)}}U.prototype=new Error,U.prototype.name="InvalidTokenError";const Re={URL:"http://localhost",API_BASE_URL:"https://antoine.saunier.com"},Ie=Re.API_BASE_URL,Le=Ie+"/users",we=async()=>{const e=localStorage.getItem("token"),n=ke(e).id;return fetch(Le+"/"+n,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(t=>t.ok?t.json():Promise.reject(t))},Pe=async()=>{localStorage.removeItem("token")},Oe={getUser:we,logout:Pe},T=Se("auth",()=>{const e=localStorage.getItem("token")||null,n=O(e),t=O(null),o=async()=>(t.value=await Oe.getUser().catch(()=>{r()}),t.value),s=async c=>{localStorage.setItem("token",c.token),n.value=c.token,await B.push("/")},r=()=>{localStorage.removeItem("token"),n.value=null,t.value=null,B.push({name:"login"})};return{token:n,user:t,me:o,login:s,logout:r}}),B=re({history:se(),routes:[{path:"/",name:"home",meta:{roles:["ROLE_USER"]},component:()=>_(()=>import("./HomeView-41c5f6da.js"),["assets/HomeView-41c5f6da.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/LikeService-df6ad75c.js","assets/runtime-dom.esm-bundler-29d64e14.js","assets/vue-router-efb649a8.js"])},{path:"/back-office/likes",name:"animalsLike",component:()=>_(()=>import("./SpaBoView-eb80786a.js"),["assets/SpaBoView-eb80786a.js","assets/TemplateBO-bb583818.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/LikeService-df6ad75c.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/vue-router-efb649a8.js","assets/SpaBoView-e377ce2e.css"]),meta:{roles:["ROLE_SPA"]}},{path:"/back-office/likes/:id",name:"likeId",component:()=>_(()=>import("./SpaLikeIdView-fac396ba.js"),["assets/SpaLikeIdView-fac396ba.js","assets/LikeService-df6ad75c.js","assets/TemplateBO-bb583818.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/vue-router-efb649a8.js","assets/_plugin-vue_export-helper-c27b6911.js","assets/SpaLikeIdView-e02bab20.css"]),meta:{roles:["ROLE_SPA"]}},{name:"register",path:"/register",meta:{roles:["ROLE_GUEST"]},component:()=>_(()=>import("./RegisterView-81375872.js"),["assets/RegisterView-81375872.js","assets/connexion-6655cd8d.js","assets/runtime-dom.esm-bundler-29d64e14.js","assets/runtime-core.esm-bundler-4092eae4.js"])},{name:"login",path:"/login",meta:{roles:["ROLE_GUEST"]},component:()=>_(()=>import("./LoginView-ecc7851e.js"),["assets/LoginView-ecc7851e.js","assets/connexion-6655cd8d.js","assets/runtime-dom.esm-bundler-29d64e14.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/vue-router-efb649a8.js"])},{name:"error",path:"/error/:code",meta:{roles:["ROLE_GUEST"]},component:()=>_(()=>import("./ErrorView-ef43f804.js"),["assets/ErrorView-ef43f804.js","assets/vue-router-efb649a8.js","assets/runtime-core.esm-bundler-4092eae4.js"])},{name:"logout",path:"/logout",meta:{roles:["ROLE_USER"]}},{name:"confirm-account",path:"/confirm-account",meta:{roles:["ROLE_GUEST"]},component:()=>_(()=>import("./ConfirmAccountView-499c3692.js"),["assets/ConfirmAccountView-499c3692.js","assets/vue-router-efb649a8.js","assets/runtime-core.esm-bundler-4092eae4.js"])},{path:"/back-office/reviews",name:"backOffice review",component:()=>_(()=>import("./ReviewBO-e8fd9523.js"),["assets/ReviewBO-e8fd9523.js","assets/TemplateBO-bb583818.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/vue-router-efb649a8.js"]),meta:{roles:["ROLE_SPA"]}},{path:"/back-office/reviews/:id",name:"rateUser",component:()=>_(()=>import("./RateUserBO-ad89657c.js"),["assets/RateUserBO-ad89657c.js","assets/runtime-dom.esm-bundler-29d64e14.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/TemplateBO-bb583818.js","assets/vee-validate.esm-678d5234.js","assets/vue-router-efb649a8.js"]),meta:{roles:["ROLE_SPA"]}},{path:"/back-office/admin/reviews",name:"backoffice",component:()=>_(()=>import("./ReviewList-1a9ce19d.js"),["assets/ReviewList-1a9ce19d.js","assets/TemplateBO-bb583818.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/adminService-5365e02d.js","assets/vue-router-efb649a8.js"]),meta:{roles:["ROLE_ADMIN"]}},{path:"/back-office/admin/reviews/:id",name:"backoffice reviews",component:()=>_(()=>import("./ReviewManagement-97224f2a.js"),["assets/ReviewManagement-97224f2a.js","assets/runtime-dom.esm-bundler-29d64e14.js","assets/runtime-core.esm-bundler-4092eae4.js","assets/TemplateBO-bb583818.js","assets/adminService-5365e02d.js","assets/vee-validate.esm-678d5234.js","assets/vue-router-efb649a8.js"]),meta:{roles:["ROLE_ADMIN"]}},{path:"/:pathMatch(.*)*",redirect:{name:"error",params:{code:404}}}]});B.beforeEach(async(e,n,t)=>{if(e.meta.roles.includes("ROLE_GUEST"))(e.name==="login"||e.name==="register")&&localStorage.getItem("token")!==null&&T().me()?t({name:"home"}):t();else if(localStorage.getItem("token")!==null){e.name==="logout"&&await T().logout();const s=await T().me();s?s.roles.some(r=>e.meta.roles.includes(r)||s.roles.includes("ROLE_ADMIN"))?t():t({name:"error",params:{code:403}}):t({name:"login"})}else t({name:"login"})});export{Ie as b,je as c,Se as d,B as r,Te as s,T as u};
